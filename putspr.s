%%HP: T(0)A(R)F(.);
"%This file is licensed
%under GPL v2

%PUTSPR.S
%TYPE OBJ NONCOMPACTE
%AU PIXEL PR»S
%SPRITE=
%hhhh.MORCEAUx
%hhhh=dÈcalage en pixels
%entre position poignee
%et debut du sprite
%MORCEAU=nq.md.datas.npb
%nbp=nbpixelsblancs
%D0çSPRITE
%Ca=XXXYY COORDSDEST

%WARNING: REMOVE
%BEFORE OPERATING
%GOSBVL 0679B
%A=DAT1 A
%D0=A
%D0=D0+ 10
%D0çLEV1
%LC 02
%GOSUB GOLEVC
%D1=D1- 5
%C=DAT1 A

*D0SPREPLCaXY
%Ca=XXXYY
A=0 A
A=C B
B=A A
ASL A
A=A+B A
ASL A
ASRB A
CSR A
CSR A
C=C+A A
%C='pix'

A=0 A
A=DAT0 4
D0=D0+ 4
C=C-A A
GOC REPL.OUT!
B=C A
%LC2GRTEMP
LC 01
GOSUBL GOLEVCb
C=C+2 A
LA 3
ABEX A
B=B&A P
BSRC
C=B S   %x mod 4
ASRB A
ASRB A
C=C+A A
D1=C
*NEXT.MORCEAU
C=DAT0 1 %nq
D0=D0+ 1
P=C 0
A=0 WP
A=-A-1 P
P=P-1

A=DAT0 P
D0=D0+ 1

B=C S
B=B-1 S
GOC NOSHIFTING
P=P+1
A=-A-1 WP
*SHIFTONS
A=A+A WP
B=B-1 S
GONC SHIFTONS
A=-A-1 WP
C=DAT1 WP
C=C&A WP
A=0 P
P=P-1
GOTO AFTERSHIFTING

*REPL.OUT!
LC EF
GOLONG ERRORCb
%'ERREUR.S

*NOSHIFTING
C=DAT1 WP
C=C&A WP
*AFTERSHIFTING


A=DAT0 WP
CD0EX
C+P+1
CD0EX
B=C S
B=B-1 S
GOC NOSHIFTING2
P=P+1
*SHIFTONS2
A=A+A WP
B=B-1 S
GONC SHIFTONS2
*NOSHIFTING2

C=C!A WP
DAT1=C WP
P= 0
C=0 A
C=DAT0 B%npb
D0=D0+ 2
?C=0 B
GOYES SPRITE.FINI
%RTNYES

A=C S
A=0 B
ASLC
C=C+A X
LA 3
A=A&C B
ASRC
C=A S
CSRB A
CSRB A

AD1EX
A=A+C A
AD1EX
GOTO NEXT.MORCEAU
*SPRITE.FINI
%GOVLNG 05143
RTN
%'GOROUTINES.S
@"