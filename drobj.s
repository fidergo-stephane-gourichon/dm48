%%HP: T(0)A(R)F(.);
"%This file is licensed
%under GPL v2

%DROBJ.S

*DROBJ
%DROBJ EST APPELE 2 FOIS
%ELLE FAIT POSES PUIS
%VOLANTS ET
%GAUCHE PUIS DROITE.
%LES FLAGS 4 ET 5 PRECISENT
%4çDERRIERE/DEVANT
%5çPOSE/VOLANT

%SI ST=1 5
%ALORS NE PAS CHANGER
%FLAG (CAS ESCALIER)
C=0 M %COMPTEUR D'OBJETS
?ST=0 5
GOYES DROBJ.CASNORMAL
C=C+1 M
*DROBJ.CASNORMAL
R4=C M % RENCONTRES
%DABORDOBPOSES
?ST=0 3
GOYES DROBJPOSEFINI
%OKOBPOSE A PRIORI
%LC2OBPOSE
LC 05
GOSUB GOLEVCb
*OBJETPOSESUIVANT
A=R3 A
B=A A %N∞CASE
P= 7 %8QUARTETSSIZE
GOSUBL SEEKB4ATFLUC
%D0=DATASCASE
GONC OK.OBPOSEHERE

C=R4 M
?Cã0 M
GOYES DROBJPOSEFINI

%OK, FINALEMENT
%AUCUN OBJET.REMETTONS
%A 0 LE BIT.

%PEUT PAS UTILISER
%C=R0 A %CçQG
%CAR R0 A CHANG….
%LC2MAPSTR
LC 03
GOSUB GOLEVCb
D1=D1+ 7
A=0 A
A=R4 X
CD1EX
C=C+A A
CD1EX
C=DAT1 1
CBIT=1 2 %PAS OBJPOSE
DAT1=C 1

%ET EVITONS DE RESCANNER
%AU MOMENT DES OBJETS
%DEVANT.
ST=0 3

*DROBJPOSEFINI
GOTO NOWOBJVOLANT

*OK.OBPOSEHERE
D=C A %ON GARDE NEXTBLOC
%SOUS LE COUDE POUR
%LA SUITE (CAS
%PLUSIEURS OBJS)

C=R4
C=C+1 M %NBRE D'OBJ RENCONTRES
R4=C
%LCSPR3DL
LC 1F
GOSUB GOLEVCb
R0=C A

A=DAT0 M
ASL W
ASL W
ASL W
ASL W
ASL W
A=DAT0 8

C=R3 S %DJ
*TOURNONS.OBPOSE
C=C-1 S
GOC OBTOURNE
ASRC
ASRC
GOTO TOURNONS.OBPOSE
*OBTOURNE
?ST=0 4
GOYES PASPROBDEVANT
ASRC
ASRC
ASRC
C=A A
ASLC
CSRC
CSRC
CSRC
A=C B
*PASPROBDEVANT
R1=A A %Aa=_ODOG

ST=0 6
*GAUCHEPUISDROIT

ST=0 5 %HAUTEUR BAS
GOSUB R0ADESSINE!

A=R1 A %Aa=_ODOG
ASR A
ASR A
?ST=1 6
GOYES GAUCHE&DROITFAIT
ST=1 6
GOTO GAUCHEPUISDROIT
*GAUCHE&DROITFAIT
C=D A %POUR LE FLUX
GOTO OBJETPOSESUIVANT

*NOWOBJVOLANT
?ST=0 2 %ILYAPAOBVICI?
GOYES PRE.CASSOS.DE.DROBVOLANT
%OKOBVOLANT %OU MONST/NUAGE
%LC2OBJVOL
LC 04
GOSUB GOLEVCb
*OBVOLANTSUIVANT
A=R3 A
B=A A %N∞CASE
P= 4 %5QUARTETSSIZE
GOSUBL SEEKB4ATFLUC
%D0=DATASCASE
GONC OK.OBVOLANTHERE
%PAS D'ERREUR:NUAGE OU MONSTRE POSSIBLE
*PRE.CASSOS.DE.DROBVOLANT
GOTO CASSOS.DE.DROBVOLANT
*OK.OBVOLANTHERE
D=C A %ON GARDE NEXTBLOC
%SOUS LE COUDE POUR
%LA SUITE
%LC2SPR3DL
LC 1F
GOSUB GOLEVCb
R0=C A %LLOBSPR

%LIRE N∞ DU SPRITE
%ET METTRE FLAG 6
%ET VERIFIER SELON
%FLAG 4 SI C'EST LE
%MOMENT POUR CET OBJET
A=DAT0 X
ASRC %As=COINPOS,Ab=N∞
C=R3 S %DJ
A=A-C S %A=COINPOS-DJ
LC 3
CSRC
C=C&A S
%0ou1=LOIN,3ou2=PRES
%0ou3=GAUCHE,1ou2=DROITE

?ST=1 4 %DEVANT?
GOYES DEVANTONLY
%DERRIEREONLY
ST=0 6
C=C-1 S
GOC OK.FLAG.SET
ST=1 6
C=C-1 S
GOC OK.FLAG.SET
GOTO PASBONNEDIST
*DEVANTONLY
C=C-1 S
GOC PASBONNEDIST
C=C-1 S
GOC PASBONNEDIST
ST=1 6
C=C-1 S
GOC OK.FLAG.SET
ST=0 6
C=C-1 S
GOC OK.FLAG.SET
LC 83
GOTO ERRORCb

*OK.FLAG.SET
ST=1 5 %EN HAUT
GOSUB R0ADESSINE!
%BON... SUIVANT
%FAUT RECUPERER LE FLUX
*PASBONNEDIST
C=D A
GOTO OBVOLANTSUIVANT

*CASSOS.DE.DROBVOLANT
RTN

*R0ADESSINE!
%ICI Ab=N∞OBJ,R0a=LLOBSPR
%FLAGS 4(DEVANT?)
%ET 6 (DROITE?)
%ET R4s=õY
A=A-1 B
GONC OBJã0
GOTO NOOBJ(0)
*OBJã0
A=A-7 B
GONC OBJ>7
LC 29
GOLONG ERRORCb
*OBJ>7
C=R0 A
D1=C %LLOBSPR
C=0 A
C=A B

A=C A
C=C+C A
A=A+C A %A=3* CAR 3 POINTEURS/OBJ
C=0 A
C=R4 S %õY
C=C+C S
C=C+C S
?ST=1 4
GOYES DEVANT
C=C+1 S
C=C+1 S
*DEVANT
P=C 15 %POUR LA SUITE
P=P+1
P=P+1
GONC OKSPRPASTROPLOIN
C=C-2 S
*OKSPRPASTROPLOIN
P=P-1
P=P-1
%Cs=EN 1/4 DE CASE
%çéçéçéç
%0000111
%2468022
CSRB S
C=C-1 S
GONC OKPASDERRMOI
GOTO OUTOFSCREEN
*OKPASDERRMOI
CSRB S
CSLC
C=C+A A %5*NSPR+DY %CECI POUR LE CAS OU 1 OBJç5 ã SPRITES F(Y)
GOSUBL D1çLLCaGET
D0=C %D0:SPR

%SELON VALEUR DE P
LC 003A2E27211F1E1D%F(õY)
P= 0 %Csr=YY
?Cã0 S
GOYES NODOUBT
CSLC
?Cã0 S
GOYES .NODOUBT
GOTO OUTOFSCREEN
*.NODOUBT
CSRC
*NODOUBT

GOSUB FINTABLXG
$53F5000000000000000000001435D37556870700C1F2004244053415B576F5E6D2936253370000000012008164E454F475F5953653D313B38607C66742C2E182
%$D0517011159555F5E162A142048424C4F273E28300A00010C50056006122F0E144058475D293C2A3508100D0E4169500A2C362040000000000000000E1840000
%Xé2*(4*Bs+2*LOIN/PRES+GAUCHE/DROITE)
*FINTABLXG
A=0 A
A=R0 S
ASLC

A=A+A A
?ST=0 4
GOYES PASLOIN
A=A+1 A
*PASLOIN

A=A+A A
?ST=0 6
GOYES C'EST.A.GAUCHE
A=A+1 A
*C'EST.A.GAUCHE

A=A+A A
C=RSTK
C=C+A A
D1=C
C=0 XS
C=DAT1 B
?C=0 B
GOYES OUTOFSCREEN
%C=C+9 B %NON
%GOC ERR
CSLC
CSLC %Cb=Y
C=C+1 B
?ST=0 5
GOYES ONAPLATITPAS
LC 15 %OBJVOLANTçHAUT
*ONAPLATITPAS
GOSUB D0SPREPLCaXY
*NOOBJ(0)
*OUTOFSCREEN
RTN
'PUTSPR.S
@"